# Общие функции работы с текстом и знаками препинания.
# Эти функции используются в разных шифрах (Атбаш, Цезарь, Полибий),
# чтобы не дублировать один и тот же код.


def create_punctuation_codes():
    """Словарь замены знаков препинания на трехбуквенные коды."""
    # Пустой словарь для пар "знак препинания -> код"
    codes = {}
    # Точка заменяется на "тчк"
    codes["."] = "тчк"
    # Запятая заменяется на "зпт"
    codes[","] = "зпт"
    # Двоеточие заменяется на "двтч"
    codes[":"] = "двтч"
    # Точка с запятой заменяется на "тчзп"
    codes[";"] = "тчзп"
    # Восклицательный знак заменяется на "вскл"
    codes["!"] = "вскл"
    # Вопросительный знак заменяется на "впрс"
    codes["?"] = "впрс"
    # Тире заменяется на "тир"
    codes["-"] = "тир"
    codes["—"] = "тир"
    # Возвращаю готовый словарь замен
    codes[" "] = "прбл"
    
    return codes


def create_code_to_punctuation(punctuation_codes):
    """Обратный словарь: код -> знак препинания."""
    # Пустой словарь для обратных пар "код -> знак"
    reverse_codes = {}
    # Перебираю каждый знак препинания из исходного словаря
    for znak in punctuation_codes:
        # Получаю соответствующий ему трёх- или четырёхбуквенный код
        kod = punctuation_codes[znak]
        # Записываю обратную пару: по коду восстанавливаю знак
        reverse_codes[kod] = znak
    # Возвращаю обратный словарь для расшифровки
    return reverse_codes


def prepare_text_for_encryption(text, punctuation_codes):
    """
    Подготовка текста:
    - перевод в нижний регистр
    - ё -> е
    - троеточие -> тчктчктчк
    - замена знаков препинания и пробела на коды
    """

    # Нижний регистр
    text = text.lower()

    # Замена ё
    text = text.replace("ё", "е")

    # Обработка троеточия заранее
    text = text.replace("...", "тчктчктчк")

    result = ""

    # Замена символов по словарю
    for symbol in text:
        if symbol in punctuation_codes:
            result = result + punctuation_codes[symbol]
        else:
            result = result + symbol

    return result


def split_into_groups_of_five(text):
    """Разбивка текста на группы по 5 символов с пробелами."""
    # Строка для вывода с пробелами между группами
    result = ""
    # Счётчик символов: после каждых 5 ставлю пробел
    counter = 0
    # Иду по каждому символу текста
    for symbol in text:
        # Перед 6-м, 11-м, 16-м и т.д. символом добавляю пробел
        if counter > 0 and counter % 5 == 0:
            result = result + " "
        # Добавляю текущий символ к результату
        result = result + symbol
        # Увеличиваю счётчик на 1
        counter = counter + 1
    # Возвращаю отформатированную строку
    return result


def restore_punctuation_from_codes(text, code_to_punctuation):
    """Восстановление знаков препинания из кодов."""
    # Строка, в которую собираю текст со знаками препинания
    result = ""
    # Текущая позиция при разборе текста (иду слева направо)
    position = 0
    # Пока не дошёл до конца строки
    while position < len(text):
        # Флаг: нашёл ли я код знака препинания на этой позиции
        code_found = False
        # Перебираю все известные коды (тчк, зпт, тир и т.д.)
        for kod in code_to_punctuation:
            # Длина кода (обычно 3 или 4 символа)
            kod_length = len(kod)
            # Проверяю, что от position вперёд хватает символов для этого кода
            if position + kod_length <= len(text):
                # Вырезаю кусок текста той же длины, что и код
                text_piece = text[position:position + kod_length]
                # Кусок совпал с кодом — это знак препинания
                if text_piece == kod:
                    # Получаю соответствующий знак препинания
                    znak = code_to_punctuation[kod]
                    # Добавляю знак в результат
                    result = result + znak
                    # Сдвигаю позицию вперёд на длину кода (код уже обработан)
                    position = position + kod_length
                    # Запоминаю, что код найден, и выхожу из цикла по кодам
                    code_found = True
                    break
        # Ни один код на этой позиции не подошёл — это обычная буква
        if code_found == False:
            # Добавляю один символ как есть и сдвигаю позицию на 1
            result = result + text[position]
            position = position + 1
    # Возвращаю текст с восстановленными знаками препинания
    return result

